[
  {
    "path": "posts/2021-08-30-in-class-exercise-3/",
    "title": "In-class Exercise 3",
    "description": "In this hands-on exercise, I learn about percentile, box, rate and relative risk map.",
    "author": [
      {
        "name": "Kwek Yi Chen",
        "url": "https://example.com/kwekyichen"
      }
    ],
    "date": "2021-08-30",
    "categories": [],
    "contents": "\r\nGetting Started\r\nThis code chunk create a list of R packages needed and install them if they are not installed.\r\n\r\n\r\npackages = c('sf', 'tmap', 'tidyverse', 'knitr', \"kableExtra\")\r\nfor (p in packages){\r\n  if(!require(p, character.only = T)){\r\n    install.packages(p)\r\n  }\r\n  library(p,character.only = T)\r\n}\r\n\r\n\r\n\r\nReading RDS file\r\nThis coded chuck reads the RDS file from the path and display the data.\r\n\r\n\r\nmpsz_pop2020 <- read_rds(\"../../../IS415/Hands-on_Ex/Hands-on_Ex03/data/rds/mpszpop2020.rds\")\r\n\r\n\r\n\r\nBoxplot using mpsz_pop2020\r\n\r\n\r\nggplot(data=mpsz_pop2020, \r\n       aes(x = \"\", \r\n           y = AGED)) +\r\n  geom_boxplot()\r\n\r\n\r\n\r\n\r\nCleaning the data by removing NA\r\nExclude records with NA\r\n\r\n\r\nmpsz_pop2020a <- mpsz_pop2020 %>%\r\n  drop_na()\r\n\r\n\r\n\r\nVisualization\r\nPercentile Map\r\nPercentile\r\n\r\n\r\npercent <- c(0,.01,.1,.5,.9,.99,1)\r\nvar <- mpsz_pop2020a[\"DEPENDENCY\"] %>%\r\n  st_set_geometry(NULL)\r\nquantile(var[,1], percent)\r\n\r\n\r\n        0%         1%        10%        50%        90%        99% \r\n 0.0000000  0.1377778  0.5686120  0.7024793  0.8474114  1.2100000 \r\n      100% \r\n19.0000000 \r\n\r\nCreating get variable function\r\n\r\n\r\nget.var <- function(vname,df) {\r\n  v <- df[vname] %>%\r\n    st_set_geometry(NULL)\r\n  v <- unname(v[,1])\r\n  return(v)\r\n}\r\n\r\n\r\n\r\nPlotting percentile map with tmap functions (hardcode)\r\n\r\n\r\npercent <- c(0,.01,.1,.5,.9,.99,1)\r\nvar = get.var(\"DEPENDENCY\", mpsz_pop2020a)\r\nbperc <- quantile(var,percent)\r\ntm_shape(mpsz_pop2020) + \r\n  tm_polygons() +\r\ntm_shape(mpsz_pop2020a) +\r\n  tm_fill(\"DEPENDENCY\",\r\n          title=\"DEPENDENCY\",\r\n          breaks=bperc,\r\n          palette=\"Blues\",\r\n          labels=c(\"< 1%\", \"1% - 10%\",\r\n                   \"10% - 50%\",\r\n                   \"50% - 90%\",\r\n                   \"90% - 99%\",\r\n                   \"> 99%\")) + \r\n  tm_borders() +\r\n  tm_layout(title = \"Percentile Map\", title.position = c(\"right\", \"bottom\"))\r\n\r\n\r\n\r\n\r\nPlotting percentile map with Percentile Mapping Function\r\n\r\n\r\npercentmap <- function(vnam, df, legtitle=NA, mtitle=\"Percentile Map\"){\r\n  percent <- c(0,.01,.1,.5,.9,.99,1)\r\n  var = get.var(vnam, df)\r\n  bperc <- quantile(var,percent)\r\n  tm_shape(df) + \r\n  tm_polygons() +\r\n  tm_shape(df) +\r\n    tm_fill(vnam,\r\n            title=legtitle,\r\n            breaks=bperc,\r\n            palette=\"Blues\",\r\n            labels=c(\"< 1%\", \"1% - 10%\",\r\n                     \"10% - 50%\",\r\n                     \"50% - 90%\",\r\n                     \"90% - 99%\",\r\n                     \"> 99%\")) + \r\n    tm_borders() +\r\n    tm_layout(title = mtitle, title.position = c(\"right\", \"bottom\"))\r\n}\r\n\r\n\r\n\r\nTesting Percentile Mapping Function (young)\r\n\r\n\r\nyoungmap <- percentmap(\"YOUNG\", mpsz_pop2020a)\r\nyoungmap\r\n\r\n\r\n\r\n\r\nTesting Percentile Mapping Function (aged)\r\n\r\n\r\nagedmap <- percentmap(\"AGED\", mpsz_pop2020a)\r\nagedmap\r\n\r\n\r\n\r\n\r\nBoxmap\r\nBoxbreaks Function\r\n\r\n\r\nboxbreaks <- function(v,mult=1.5) {\r\n  qv <- unname(quantile(v))\r\n  iqr <- qv[4] - qv[2]\r\n  upfence <- qv[4] + mult * iqr\r\n  lofence <- qv[2] - mult * iqr\r\n  # initialize break points vector\r\n  bb <- vector(mode=\"numeric\",length=7)\r\n  # logic for lower and upper fences\r\n  if (lofence < qv[1]) {# no lower outliers\r\n    bb[1] <- lofence\r\n    bb[2] <- floor(qv[1])\r\n  } else {\r\n    bb[2] <- lofence\r\n    bb[1] <- qv[1]\r\n  }\r\n  if (upfence > qv[5]) {# no upper outliers\r\n    bb[7] <- upfence\r\n    bb[6] <- ceiling(qv[5])\r\n  } else {\r\n    bb[6] <- upfence\r\n    bb[7] <- qv[5]\r\n  }\r\n  bb[3:5] <- qv[2:4]\r\n  return(bb)\r\n}\r\n\r\n\r\n\r\nCreating get variable function\r\n\r\n\r\nget.var <- function(vname,df) {\r\n  v <- df[vname] %>%\r\n    st_set_geometry(NULL)\r\n  v <- unname(v[,1])\r\n  return(v)\r\n}\r\n\r\n\r\n\r\nTesting the Boxbreaks Function on AGED using mpsz_pop2020 will result in error.\r\nSince missing values and NaNâ€™s are not allowed, we will exclude AGED = NA\r\n\r\n\r\nmpsz_pop2020b <- mpsz_pop2020 %>%\r\n  filter(AGED>=0)\r\nvar <- get.var(\"AGED\", mpsz_pop2020b)\r\nboxbreaks(var)\r\n\r\n\r\n[1] -4330     0   515  2080  3745  8590 20240\r\n\r\nBoxmap Function\r\n\r\n\r\nboxmap <- function(vnam, df, \r\n                   legtitle=NA,\r\n                   mtitle=\"Box Map\",\r\n                   mult=1.5){\r\n  var <- get.var(vnam,df)\r\n  bb <- boxbreaks(var)\r\n  tm_shape(df) +\r\n     tm_fill(vnam,title=legtitle,\r\n             breaks=bb,\r\n             palette=\"Blues\",\r\n          labels = c(\"lower outlier\", \r\n                     \"< 25%\", \r\n                     \"25% - 50%\", \r\n                     \"50% - 75%\",\r\n                     \"> 75%\", \r\n                     \"upper outlier\"))  +\r\n  tm_borders() +\r\n  tm_layout(title = mtitle, \r\n            title.position = c(\"right\",\r\n                               \"bottom\"))\r\n}\r\n\r\n\r\n\r\nTesting Boxmap function (AGED)\r\n\r\n\r\nboxmap(\"AGED\", mpsz_pop2020b)\r\n\r\n\r\n\r\n\r\nBoxmap Function (Missing Area Fix)\r\n\r\n\r\nboxmap <- function(vnam, df, \r\n                   legtitle=NA,\r\n                   mtitle=\"Box Map\",\r\n                   mult=1.5){\r\n  var <- get.var(vnam,df)\r\n  bb <- boxbreaks(var)\r\n  tm_shape(mpsz_pop2020) +\r\n  tm_polygons() +\r\n  tm_shape(df) +\r\n     tm_fill(vnam,title=legtitle,\r\n             breaks=bb,\r\n             palette=\"Blues\",\r\n          labels = c(\"lower outlier\", \r\n                     \"< 25%\", \r\n                     \"25% - 50%\", \r\n                     \"50% - 75%\",\r\n                     \"> 75%\", \r\n                     \"upper outlier\"))  +\r\n  tm_borders() +\r\n  tm_layout(title = mtitle, \r\n            title.position = c(\"right\",\r\n                               \"bottom\"))\r\n}\r\n\r\n\r\n\r\nTesting Boxmap function (AGED)\r\n\r\n\r\nboxmap(\"AGED\", mpsz_pop2020b)\r\n\r\n\r\n\r\n\r\nRaw Rate Map\r\nCompute raw rate\r\n\r\n\r\nmpsz_pop2020c <- mpsz_pop2020 %>%\r\n  mutate(`AGED%` = (`AGED`/`TOTAL`)*100) %>%\r\n  filter(`AGED%` >= 0)\r\n\r\n\r\n\r\nPlot Raw rate map using Boxmap function\r\n\r\n\r\nvar <- get.var(\"AGED%\", mpsz_pop2020c)\r\nboxbreaks(var)\r\n\r\n\r\n[1] -2.17276  0.00000 11.28169 16.48199 20.25132 33.70576 95.00000\r\n\r\nboxmap(\"AGED%\",mpsz_pop2020c)\r\n\r\n\r\n\r\n\r\nRelative Risk Map\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
    "preview": "posts/2021-08-30-in-class-exercise-3/in-class-exercise-3_files/figure-html5/unnamed-chunk-3-1.png",
    "last_modified": "2021-08-30T21:15:28+08:00",
    "input_file": "in-class-exercise-3.knit.md"
  },
  {
    "path": "posts/2021-08-23-in-class-exercise-2/",
    "title": "In-class Exercise 2",
    "description": "In this hands-on exercise, I learn how to handle geospatial data in R by using sf package.",
    "author": [
      {
        "name": "Kwek Yi Chen",
        "url": "https://example.com/kwekyichen"
      }
    ],
    "date": "2021-08-23",
    "categories": [],
    "contents": "\r\nGetting Started\r\nThis code chunk performs three tasks:\r\ncreate a list of R packages needed.\r\n\r\n\r\npackages <- c('sf', 'tidyverse')\r\nfor(p in packages){\r\n  if(!require(p, character.only = T)){\r\n    install.packages(p)\r\n  }\r\n  library(p, character.only = T)\r\n}\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
    "preview": {},
    "last_modified": "2021-08-23T11:29:01+08:00",
    "input_file": {}
  },
  {
    "path": "posts/welcome/",
    "title": "Welcome to IS415 blog",
    "description": "Welcome to our new blog, IS415 blog. We hope you enjoy \nreading what we have to say!",
    "author": [
      {
        "name": "Kwek Yi Chen",
        "url": "https://example.com/kwekyichen"
      }
    ],
    "date": "2021-08-23",
    "categories": [],
    "contents": "\r\n\r\n\r\n\r\n",
    "preview": {},
    "last_modified": "2021-08-23T09:42:38+08:00",
    "input_file": {}
  }
]
